module.exports=__NEXT_REGISTER_PAGE("/docs/guides/how-to-use-cloudflare",function(){var e=webpackJsonp([5],{12:function(e,t,a){e.exports=a(9)},13:function(e,t,a){"use strict";var l=a(2);var r=a.n(l);var o=a(0);var n=a.n(o);var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)if(Object.prototype.hasOwnProperty.call(a,l))e[l]=a[l]}return e};var s=function e(t){var a=t.src,l=t.width,o=t.height,c=t.margin,s=void 0===c?40:c,i=t.caption,u=t.video,m=void 0===u?false:u,d=t.muted,h=void 0===d?true:d,p=t.autoPlay,f=void 0===p?false:p;if(!l)throw new Error("Please define the width of the image!");if(!o)throw new Error("Please define the height of the image!");var E=String(o/l*100)+"%";return n.a.createElement("figure",{style:{margin:s+"px 0"},className:"jsx-2503757143"},n.a.createElement("main",{style:{width:l},className:"jsx-2503757143"},n.a.createElement("div",{style:{paddingBottom:E},className:"jsx-2503757143"},m?n.a.createElement("video",{src:a,muted:h,autoPlay:f,className:"jsx-2503757143"}):n.a.createElement("img",{src:a,className:"jsx-2503757143"})),i&&n.a.createElement("p",{className:"jsx-2503757143"},i)),n.a.createElement(r.a,{styleId:"2503757143",css:["figure.jsx-2503757143{text-align:center;display:block;}","main.jsx-2503757143{margin:0 auto;max-width:100%;}","div.jsx-2503757143{position:relative;}","img.jsx-2503757143,video.jsx-2503757143{position:absolute;top:0;left:0;height:100%;width:100%;}","p.jsx-2503757143{font-size:11px;text-align:center;color:#999;}"]}))};var i=function e(t){return n.a.createElement(s,c({},t,{video:true}))};t["a"]=s},410:function(e,t,a){e.exports=a(411)},411:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var l=a(0);var r=a.n(l);var o=a(3);var n=a.n(o);var c=a(12);var s=a.n(c);var i=a(6);var u=a(7);var m=a(10);var d=a(13);var h=a(14);t["default"]=Object(i["b"])({title:"How to Use Cloudflare with Now",date:"11 Jan 2018 11:34 AM PDT",authors:[u["a"]],editUrl:"pages/docs/guides/how-to-use-cloudflare.js"})(n()(i["a"],function(e){return r.a.createElement("div",{className:"_markdown_"},r.a.createElement(e.p,null,"In this guide, we are looking at how we can use ",r.a.createElement(e.a,{href:"https://www.cloudflare.com/"},"Cloudflare")," with ",r.a.createElement(m["a"],{color:"#000"}),"."),r.a.createElement(e.h2,null,"Cloudflare as a DNS Server"),r.a.createElement(e.p,null,"Here we'll be using Cloudflare as a pure DNS service. We setup a few DNS records, which allows your domain to work with ",r.a.createElement(m["a"],{color:"#000"}),"."),r.a.createElement(e.blockquote,null,r.a.createElement(e.p,null,"These steps are valid for any external DNS service, not just Cloudflare.")),r.a.createElement(e.h3,null,"1. Setting Up"),r.a.createElement(e.p,null,"First of all, add our domain (",r.a.createElement(e.code,null,"my-app.work"),") to ",r.a.createElement(m["a"],{color:"#000"})," with:"),r.a.createElement(e.p,null,r.a.createElement(h["a"],null,"now domain add --external my-app.work")),r.a.createElement(e.p,null,"Then, ",r.a.createElement(m["a"],{color:"#000"})," will ask you to create a TXT record in the domain's DNS provider."),r.a.createElement(e.p,null,"Here's how the Cloudflare's DNS settings page looks after we've added the TXT record."),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-now-txt.png"),width:600,height:336})),r.a.createElement(e.blockquote,null,r.a.createElement(e.p,null,"This TXT record verifies the ownership of your domain name, So ",r.a.createElement(m["a"],{color:"#000"})," can create SSL certificates automatically, as needed.")),r.a.createElement(e.h3,null,"2. Add CNAME Record"),r.a.createElement(e.p,null,r.a.createElement(m["a"],{color:"#000"})," we can add a CNAME record which allows Cloudflare to direct traffic to ",r.a.createElement(m["a"],{color:"#000"}),". If we want to serve ",r.a.createElement(e.code,null,"ui.my-app.work")," we need to add a CNAME with the following information:"),r.a.createElement(e.ul,null,r.a.createElement(e.li,null,"Name: ",r.a.createElement(e.code,null,"ui")),r.a.createElement(e.li,null,"Domain: ",r.a.createElement(e.code,null,"alias.zeit.co"))),r.a.createElement(e.blockquote,null,r.a.createElement(e.p,null,"You can also use @ as the Name of the CNAME record. Then, the record applies for the root domain, ",r.a.createElement(e.code,null,"my-app.work"),".")),r.a.createElement(e.p,null,"Make sure to ",r.a.createElement(e.strong,null,"uncheck")," the cloud symbol for the Record. So, Cloudflare only act as a DNS server for this sub domain. (It should look like the below)"),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-dns-records.png"),width:600,height:259})),r.a.createElement(e.h3,null,"3. Alias Inside Now"),r.a.createElement(e.p,null,"Finally alias  ",r.a.createElement(e.code,null,"ui.my-app.work")," for any deployment in ",r.a.createElement(m["a"],{color:"#000"}),":"),r.a.createElement(e.p,null,r.a.createElement(h["a"],null,"now alias hello-szrpyfhgwp.now.sh ui.my-app.work")),r.a.createElement(e.p,null,"Then, you can access the deployment via ",r.a.createElement(e.a,{href:"https://ui.my-app.work/"},"https://ui.my-app.work")," in no time."),r.a.createElement(e.h3,null,"4. Next Sub-Domain"),r.a.createElement(e.p,null,"For the next sub-domain, you only need to follow Step 2 and 3. Setup (Step 1) is a one time job."),r.a.createElement(e.h2,null,"Cloudflare as a Proxy Server"),r.a.createElement(e.p,null,"In the above case, Cloudflare only act as a DNS server. It simply forwards the traffic to ",r.a.createElement(m["a"],{color:"#000"})," via DNS. With this mode, Cloudflare accept the traffic and act as a proxy server. This allow Cloudflare to do interesting things like OneClick SSL, DDOS protection, CDN features and more."),r.a.createElement(e.p,null,"To get started, we need to apply all of the above steps. Then, go through the following steps:"),r.a.createElement(e.h3,null,"1. Enable the Proxy Mode"),r.a.createElement(e.p,null,"For that, simply check the Cloud icon next to the Domain name (in the DNS settings page). Then it'll look like this:"),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-dns-proxy-mode.png"),width:600,height:259})),r.a.createElement(e.h3,null,"2. Use Full (Strict) Encryption"),r.a.createElement(e.p,null,"With this setup, Cloudflare communicates with ",r.a.createElement(m["a"],{color:"#000"})," using SSL. This is very important since ",r.a.createElement(m["a"],{color:"#000"})," serves pages via HTTPS only."),r.a.createElement(e.p,null,"For that, go to the Crypto settings page and select the Full (Strict) mode."),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-full-strict-ssl.png"),width:600,height:321})),r.a.createElement(e.h3,null,"3. Allow Now to Renew Certificates"),r.a.createElement(e.p,null,"With the above step, Cloudflare communicates via ",r.a.createElement(m["a"],{color:"#000"})," using SSL. ",r.a.createElement(m["a"],{color:"#000"})," uses LetsEncrypt to issue SSL certificates. So, it needs to renew the certificate from time to time."),r.a.createElement(e.p,null,"As a part of that, LetsEncrypt needs to access a special URL of your app (without SSL). So, Cloudflare should not serve that URL with SSL. For that, we need to add a Cloudflare page rule as shown below:"),r.a.createElement(e.p,null,"The URL should be: ",r.a.createElement(e.code,null,"*my-app.work/.well-known/acme-challenge/*"),"  and the setting should be ",r.a.createElement(e.strong,null,"SSL=OFF"),"."),r.a.createElement(e.blockquote,null,r.a.createElement(e.p,null,"You need to replace ",r.a.createElement(e.strong,null,"my-app.work")," with your domain name.")),r.a.createElement(e.p,null,"This is what it looks like when creating the rule:"),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-page-rule-ssl-off.png"),width:600,height:344})),r.a.createElement(e.p,null,"Finally, make sure to keep the above rule on the top of the list. Otherwise, it'll get overridden by some other rule like “Always Use HTTPS”."),r.a.createElement(e.p,null,r.a.createElement(d["a"],{src:s()("/docs/how-to-use-cloudflare/cloudflare-page-rules-ssl-off-on-top.png"),width:600,height:107})),r.a.createElement(e.h3,null,"4. Next Sub-Domain"),r.a.createElement(e.p,null,"For your next sub-domain, you only need to follow step 1."))}))},9:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=r;t.setAssetPrefix=o;var l=void 0;function r(e){if(/^https?:\/\//.test(e))return e;var t=e.replace(/^\//,"");return(l||"")+"/static/"+t}function o(e){l=e}}},[410]);return{page:e.default}});